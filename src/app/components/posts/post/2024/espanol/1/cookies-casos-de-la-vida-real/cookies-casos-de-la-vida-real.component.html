<h1 class="post-title">Cookies casos de la vida real</h1>
<article>

  <p>He estado trabajando en un proyecto en Ruby on Rails √∫ltimamente que fue bastante desafiante ya que presentaba
    varios
    escenarios en el que se pueden usar cookies de manera distinta. Aventurarme con cookies me ha hecho aprender
    bastante sobre c√≥mo se configuran y comportan. Deseo compartir este conocimiento ya que no hay mucha informaci√≥n por
    ah√≠ y quiero hacer una recopilaci√≥n que sirva como gu√≠a a futuro. Este tutorial admite que tienes conocimiento de
    c√≥mo
    crear un controlador y una acci√≥n en Rails.</p>

  <h2>Qu√© son las cookies?</h2>
  <p>Las cookies son peque√±os archivos de texto que se guardan en el navegador y que pueden accederse desde el Front-end
    o enviarse al Back-end.</p>

  <h2>Para qu√© sirven?</h2>
  <p>Por fin vas a entenderlo de una manera super f√°cil: El protocolo HTTP que maneja la comunicaci√≥n entre front-end y
    back-end no guarda ning√∫n tipo de estado (esto en ingles se lo conoce como stateless), o sea cuando est√°s en un
    pagina y le das a un link o a un bot√≥n y el mismo manda informaci√≥n al back-end la pr√≥xima acci√≥n que realices ser√°
    una acci√≥n completamente nueva para el servidor. Te doy un ejemplo:</p>

  <ul>
    <li>
      <h3>Paso #1 Front-end</h3>
      <p>Llenas el formulario de inicio de sesi√≥n en tu sitio web favorito de programaci√≥n en Rails.</p>
      <img
        class="post-img"
        src="https://res.cloudinary.com/dsqwyfxat/image/upload/v1727264713/Cookies_casos_de_la_vida_real_1_d0hlga.png"
        alt="login">
    </li>
    <li>
      <h3>Paso #2 Back-end</h3>
      <p>El backend recibe tus credenciales y luego de hacer las verificaciones correspondientes redirecciona hacia la
        p√°gina principal del sitio.</p>
    </li>
    <li>
      <h3>Paso #3 Front-end</h3>
      <p>Est√°s en la p√°gina principal y ves que tu nombre sale ah√≠ arriba como usuario autenticado y le das click a un
        link que dice: Ultimas novedades de Ruby on Rails.</p>
    </li>
    <li>
      <h3>Paso #4 Front-end</h3>
      <p>Decides navegar a otra p√°gina dentro del sitio web y das click en un enlace. Se manda la solicitud para abrir
        la nueva p√°gina pero se verifica que esta es solo accesible para usuarios
        autenticados.</p>
        <p>El front-end pregunta al back-end : ¬øHay alg√∫n usuario autenticado? y el back-end
        responde: Yo que s√©! ü§î a mi los request me llegan todos como si fueran uno nuevo (stateless). No tengo forma de
        saber si un request tiene relaci√≥n con otro.</p>

      <p>¬øEntendiste el problema? Para eso sirven las cookies üòè.Cuando
        inicias sesi√≥n en un sitio web en ese momento se crea una cookie(cookie de sesi√≥n). Esa cookie ser√° enviada
        autom√°ticamente por el
        navegador en todos los request futuros que haga el front-end hasta que la cookie expire.</p>

      <p>Las cookies sirven
        para almacenar algun dato importante que deseas conservar entre requests. ¬øTe quedo claro? Si no, volvelo a leer
        porque para entender lo que viene el concepto debe quedarte claro.</p>
    </li>
  </ul>

  <h2>Configurando una cookie</h2>
  <p>Vamos a la acci√≥n. Abr√≠: <span class="post-span">app / controllers / application_controller.rb</span> en tu app de Ruby on Rails y escribe lo
    siguiente:</p>

  <app-code-highlight fileName="application_controller.rb" gistId="6f1729c640807faf99bfe37dabbd9ae4" />

  <p>Entendamos el c√≥digo de arriba: Lo √∫nico que est√°s haciendo es crear un callback para que el m√©todo <span class="post-span">set_cookie</span>
    se
    llame antes de cualquier otra acci√≥. Dentro del m√©todo creamos la nueva cookie con el nombre de ‚Äúmy_first_cookie‚Äù
    y luego le asignamos un valor de 'Learning cookies with Rails Genius'. Listo ya est√° creada tu cookie. Ahora
    arrancamos
    nuestro servidor de Rails con el comando <span class="post-span">rails server</span> y visitamos la direccion
    <span class="post-span">localhost:3000</span> en nuestro navegador. Abrimos la pagina principal en
    nuestro navegador y la podemos ver en la pesta√±a apps del developer tools (Puedes apretar f9 para abrilo)</p>
  <img
    class="post-img"
    src="https://res.cloudinary.com/dsqwyfxat/image/upload/v1727267071/Cookies_casos_de_la_vida_real_3_er8kcf.png"
       alt="">

  <h2>Propiedades de una cookie</h2>
  <app-code-highlight fileName="cookies1.rb" gistId="9e8d28285b25e565538c9cbb916da241" />

  <h3>my_cookie</h3>
  <p>El nombre de tu cookie. Ponle el nombre de la chica que te gustaba y te rechaz√≥ por ser programador üòÖ. Una buena
    pr√°ctica es poner un nombre intuitivo y que comience con barra baja: <span class="post-span">_misitio_session</span></p>

  <h3>value</h3>
  <p>Es el valor que le quieres dar a tu cookie. No pongas cosas complejas como modelos de active record, es mejor¬†
    mantener el valor lo m√°s simple posible. Por ejemplo si quieres guardar un modelo de active record solo guarda su id
    y luego lo buscas con eso</p>

  <h3>domain</h3>
  <p>La propiedad domain nos dice que dominio o subdominio puede acceder (leer) la cookie.Veamos algunos ejemplos:</p>

  <p>Nuestro Dominio sera: ruby_latam.com y el subdominio que cre√≥ la cookie sera **noticias.ruby_latam.com</p>


  <p>Sin poner la propiedad domain</p>
  <p>Solo enviar√° la cookie al subdominio que la cre√≥ y a ning√∫n otro.</p>
  <ul>
    <li>
      <p><span class="post-span">‚úÖ noticias.ruby_latam.com</span> SI podr√° leer la cookie</p>
    </li>
    <li>
      <p><span class="post-span">‚ùå empleos.ruby_latam.com</span> NO podr√° leer la cookie.</p>
    </li>
  </ul>

  <p>domain: .ruby_latam.com</p>
  <p>Enviar√° a todos los subdominios.</p>
  <ul>
    <li>
      <p><span class="post-span">‚úÖ noticias.ruby_latam.com</span> SI podr√° leer la cookie</p>
    </li>
    <li>
      <p><span class="post-span">‚úÖ empleos.ruby_latam.com</span> SI podr√° leer la cookie.</p>
    </li>
  </ul>

  <p>domain: :all</p>
  <p>Enviar√° a todos los subdominios.</p>
  <ul>
    <li>
      <p><span class="post-span">‚úÖ noticias.ruby_latam.com</span> SI podr√° leer la cookie</p>
    </li>
    <li>
      <p><span class="post-span">‚úÖ empleos.ruby_latam.com</span> SI podr√° leer la cookie.</p>
    </li>
    <li>
      <p>* Si pones :all tambien puedes configurar el tdl_length: O sea el largo que tiene tu subdominio.
        Por ejemplo:
        blog.ruby_latam.com tiene un tdl_length de 2: blog y ruby_latam
        espanol.blog.ruby_latam.com tiene un tdl_length de 3: espanol, blog y ruby_latam</p>
    </li>
  </ul>

  <p>domain: %w(.ruby_latam.com .ruby_europe.org)</p>
  <p>Enviar√° a diferentes dominios.</p>
  <ul>
    <li>
      <p><span class="post-span">‚úÖ noticias.ruby_latam.com</span> SI podr√° leer la cookie</p>
    </li>
    <li>
      <p><span class="post-span">‚úÖ novedades.ruby_europe.org</span> SI podr√° leer la cookie.</p>
    </li>
  </ul>

  <h3>Secure</h3>
  <p>Si es true quiere decir que la cookie solo se transmitir√° desde sitios web que tengan https. Si estas en localhost
    haciendo pruebas ponla en false.</p>
  <p>Tip: con el siguiente comando se pondra en false si estas en develpment y true si estas en produccion:</p>
  <app-code-highlight fileName="cookies2.rb" gistId="601a2cf072d7b21d1436a9e0ddaa1a5c" />

  <h3>http_only</h3>
  <p>Si esta opci√≥n est√° como true el Front-end NO podr√° leer la cookie s√≥lo la podr√° descifrarla el Back-end.</p>

  <h3>expire_after</h3>
  <p>El tiempo en que expira la cookie una vez que no tenga actividad. Si le pones una hora a cada nuevo request se
    actualiza de nuevo para una hora m√°s.</p>

  <h3>same_site</h3>
  <p>none: Permite que la cookie se env√≠e desde cualquier sitio externo. Esto puede ocasionar que te hackeen con un
    ataque Cross Site Request Forgery. Tengo un post en el que te explico como funciona:</p>
  <a
    href="https://medium.com/@marceloalarconbarrenechea/entendiendo-como-funciona-el-csfr-en-ruby-on-rails-cf2ed4c45447">Entendiendo
    como funciona el CSFR en Ruby on Rails</a>
  <p>lax: Este valor es una buena opci√≥n por defecto, ya que permite que las cookies se env√≠en en la mayor√≠a de las
    solicitudes de navegaci√≥n de nivel sup erior, pero las bloquea en contextos de cross-site en ciertos casos, como
    formularios POST enviados desde otros sitios.</p>

  <p>strict: En este caso solo se enviar√° la cookie desde el dominio que la cre√≥. Por ejemplo la cookie fue creada en
    <span class="post-span">blog.ruby_latam.com</span> asi que el front-end debe estar igual en <span class="post-span">blog.ruby_latam.com</span> porque
    sino no la mandar√°. Por
    ejemplo, si tu front-end est√° en <span class="post-span">front_end.ruby_latam.com</span> NO se mandar√° la cookie.</p>

  <h2>Volviendote Genio en Cookies de Ruby on Rails</h2>
  <p>Practiquemos todo lo que ya sabemos: Crea una nueva app de rails y luego genera un controlador en tu terminal
    as√≠:</p>

  <app-code-highlight fileName="cookies3.rb" gistId="c45fbcf45948fa339ab21f3695f2414f" />

  <p>Abre tu nuevo controlador y en la accion set_cookies crearemos nuestra nueva cookie:</p>
  <app-code-highlight fileName="cookies4.rb" gistId="40a0cbb4b40693919398294d4d63f1f1" />
  <img
    class="post-img"
    src="https://res.cloudinary.com/dsqwyfxat/image/upload/v1727698911/Cookies_casos_de_la_vida_real_4_zug0o2.png"
       alt="">

  <p>Como ves la cookie se encuentra all√≠ y est√° lista para leerse.Ahora vamos a nuestra pr√≥xima acci√≥n y pongamos lo
    siguiente:</p>
  <app-code-highlight fileName="cookies5.rb" gistId="e242af1b9bee210d4fc2ac5ff901e1dc" />

  <p>Abrimos la vista correspondiente en <span class="post-span">app/ views/ handle_cookies/ set_cookie.html.erb</span> y ponemos lo
    siguiente:</p>
  <app-code-highlight fileName="set_cookie.rb" gistId="cf6349120c209e48ff112bfbfaa757ae" />

  <p>Y el resultado ya lo podemos ver si vamos a la siguiente url:</p>
  <img
    class="post-img"
    src="https://res.cloudinary.com/dsqwyfxat/image/upload/v1727699202/Cookies_casos_de_la_vida_real_5_io41tm.png"
       alt="">

  <p>Ten en cuenta que le pusimos el tiempo de expiraci√≥n en 5 minutos, si te tardas mucho en hacer todo el
    procedimiento puede ser que la cookie desaparezca. Para volverla a generar solo visita la primera acci√≥n nuevamente.
    Listo üéâüéâüéâüéâ</p>

  <h2>Dejando atras el n√≠vel junior</h2>
  <p>Ahora veremos unos casos m√°s avanzados.</p>

  <h3>Cookie Signed</h3>
  <p>Suponte que quieres mandar una cookie al frontend para que lea la informaci√≥n pero no quieres que alguien malicioso
    pueda modificarla. Para eso existe cookies.signed. Lo que har√° ser√° mandar la informaci√≥n al frontend pero firmada
    con una clave que solo tiene el backend, si en alg√∫n momento la informaci√≥n es alterada la cookie dejar√° de ser
    valida y devolver√° nil.</p>

  <p>Creando:</p>
  <app-code-highlight fileName="cookies6.rb" gistId="e3a30a695e93f4ad54131259ead420f0" />

  <p>Recuperando</p>
  <app-code-highlight fileName="cookies7.rb" gistId="1bed8dc891314afaebb510c3b298f8ac" />

  <h3>Cookie Encrypted</h3>
  <p>Esta cookie igual que la anterior ira firmada pero con la diferencia que los datos estaran encriptados y el
    frontend no podra leerla.</p>
  <app-code-highlight fileName="cookies8.rb" gistId="667dd048cc20b83b2e4ca63e13a7cf33" />

  <h3>Cookie Permanent</h3>
  <p>Esta cookie tendra una validez de 20 a√±os. Usala si quieres que los datos esten accesibles por un largo periodo de
    tiempo</p>

  <p>Tip: Todos estos m√©todos pueden encadenarse:</p>
  <app-code-highlight fileName="cookies10.rb" gistId="14153bffe546c3d93e09a26b287b9a1d" />

  <p>Espero que hayas conseguido entender como funcionan las cookies. No te olvides que solo este es el comienzo y debes
    profundizar en otros aspectos luego por tu cuenta. Ruby on Rails es un framework maravilloso que impulsa la
    creacion rapida y que su comunidad cree firmemente que hay formas de avanzar en la tecnologia sin tener que
    destruirnos entre todos nosotros. Un saludo y hasta la proxima.</p>
</article>

ip: Todos estos m√©todos pueden encadenarse"

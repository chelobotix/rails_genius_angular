<h1 class="post-title">Cookies casos de la vida real</h1>
<article>
  <p class="post-p">
    He estado trabajando en un proyecto en Ruby on Rails √∫ltimamente que fue bastante desafiante ya que presentaba
    varios escenarios en el que se pueden usar cookies de manera distinta. Aventurarme con cookies me ha hecho aprender
    bastante sobre c√≥mo se configuran y comportan. Deseo compartir este conocimiento ya que no hay mucha informaci√≥n por
    ah√≠ y quiero hacer una recopilaci√≥n que sirva como gu√≠a a futuro. Este tutorial admite que tienes conocimiento de
    c√≥mo crear un controlador y una acci√≥n en Rails.
  </p>

  <h2 class="post-h2">Qu√© son las cookies?</h2>
  <p class="post-p">
    Las cookies son peque√±os archivos de texto que se guardan en el navegador y que pueden accederse desde el Front-end
    o enviarse al Back-end.
  </p>

  <h2 class="post-h2">Para qu√© sirven?</h2>
  <p class="post-p">
    Por fin vas a entenderlo de una manera super f√°cil: El protocolo HTTP que maneja la comunicaci√≥n entre front-end y
    back-end no guarda ning√∫n tipo de estado (esto en ingles se lo conoce como stateless), o sea cuando est√°s en un
    pagina y le das a un link o a un bot√≥n y el mismo manda informaci√≥n al back-end la pr√≥xima acci√≥n que realices ser√°
    una acci√≥n completamente nueva para el servidor. Te doy un ejemplo:
  </p>
  <p>Dale click a los pasos:</p>

  <p-stepper orientation="vertical">
    <p-stepperPanel header="Front-end">
      <ng-template pTemplate="content" let-nextCallback="nextCallback" let-index="index">
        <p class="post-p">
          Llenas el formulario de inicio de sesi√≥n en tu sitio web favorito de programaci√≥n en Rails.
        </p>
        <a
          href="https://res.cloudinary.com/dsqwyfxat/image/upload/v1729603300/dsa%20dsadasdass/lijzvxqpir3dxvpoqtyb.png"
          data-lightbox="roadtrip"
          class="cursor justify-items-center"
          ><img
            src="https://res.cloudinary.com/dsqwyfxat/image/upload/c_thumb,w_200,g_face/v1729603300/dsa%20dsadasdass/lijzvxqpir3dxvpoqtyb.png"
            alt=""
        /></a>
      </ng-template>
    </p-stepperPanel>
    <p-stepperPanel header="Back-end">
      <ng-template pTemplate="content" let-nextCallback="nextCallback" let-index="index">
        <p class="post-p">
          El backend recibe tus credenciales y luego de hacer las verificaciones correspondientes redirecciona hacia la
          p√°gina principal del sitio.
        </p>
      </ng-template>
    </p-stepperPanel>
    <p-stepperPanel header="Front-end">
      <ng-template pTemplate="content" let-nextCallback="nextCallback" let-index="index">
        <p class="post-p">
          Est√°s en la p√°gina principal y ves que tu nombre sale ah√≠ arriba como usuario autenticado y le das click a un
          link que dice: Ultimas novedades de Ruby on Rails.
        </p>
        <a
          href="https://res.cloudinary.com/dsqwyfxat/image/upload/v1729601883/dasd/g7z4db4wzxptpdfxtfnk.jpg"
          data-lightbox="roadtrip"
          class="cursor justify-items-center"
          ><img
            src="https://res.cloudinary.com/dsqwyfxat/image/upload/c_thumb,w_200,g_face/v1729601883/dasd/g7z4db4wzxptpdfxtfnk.jpg"
            alt=""
        /></a>
      </ng-template>
    </p-stepperPanel>
    <p-stepperPanel header="Front-end Back-end">
      <ng-template pTemplate="content" let-nextCallback="nextCallback" let-index="index">
        <p class="post-p">
          Decides navegar a otra p√°gina dentro del sitio web y das click en un enlace. Se manda la solicitud para abrir
          la nueva p√°gina pero se verifica que esta es solo accesible para usuarios autenticados.
        </p>
        <p class="post-p">
          El front-end pregunta al back-end : ¬øHay alg√∫n usuario autenticado? y el back-end responde: Yo que s√©! ü§î a mi
          los request me llegan todos como si fueran uno nuevo (stateless). No tengo forma de saber si un request tiene
          relaci√≥n con otro.
        </p>

        <p class="post-p">
          ¬øEntendiste el problema? Para eso sirven las cookies üòè.Cuando inicias sesi√≥n en un sitio web en ese momento
          se crea una cookie(cookie de sesi√≥n). Esa cookie ser√° enviada autom√°ticamente por el navegador en todos los
          request futuros que haga el front-end hasta que la cookie expire.
        </p>
        <a
          href="https://res.cloudinary.com/dsqwyfxat/image/upload/v1729601883/dasd/g7z4db4wzxptpdfxtfnk.jpg"
          data-lightbox="roadtrip"
          class="cursor justify-items-center"
          ><img
            src="https://res.cloudinary.com/dsqwyfxat/image/upload/c_thumb,w_200,g_face/v1729601883/dasd/g7z4db4wzxptpdfxtfnk.jpg"
            alt=""
        /></a>

        <p class="post-p">
          Las cookies sirven para almacenar algun dato importante que deseas conservar entre requests.
        </p>
      </ng-template>
    </p-stepperPanel>
  </p-stepper>

  <p>¬øTe quedo claro? Si no, volvelo a leer porque para entender lo que viene el concepto debe quedarte claro.</p>

  <h2 class="post-h2">Configurando una cookie</h2>
  <p class="post-p">
    Vamos a la acci√≥n. Abr√≠: <span class="post-span">app / controllers / application_controller.rb</span> en tu app de
    Ruby on Rails y escribe lo siguiente:
  </p>

  <app-code-highlight [code]="code_array[0]" language="ruby" />

  <p class="post-p">
    Entendamos el c√≥digo de arriba: Lo √∫nico que est√°s haciendo es crear un callback para que el m√©todo
    <span class="post-span">set_cookie</span> se llame antes de cualquier otra acci√≥n. Dentro del m√©todo creamos la
    nueva cookie con el nombre de <span>‚Äúmy_first_cookie‚Äù</span> y luego le asignamos un valor de 'Learning cookies with
    Rails Genius'. Listo ya est√° creada tu cookie. Ahora arrancamos nuestro servidor de Rails con el comando
    <span class="post-span">rails server</span> y visitamos la direccion
    <span class="post-span">localhost:3000</span> en nuestro navegador. Abrimos la pagina principal en nuestro navegador
    y la podemos ver en la pesta√±a apps del developer tools (Puedes apretar f9 para abrilo)
  </p>
  <a
    href="https://res.cloudinary.com/dsqwyfxat/image/upload/v1727267071/Cookies_casos_de_la_vida_real_3_er8kcf.png"
    data-lightbox="roadtrip"
    class="cursor justify-items-center"
    ><img
      src="https://res.cloudinary.com/dsqwyfxat/image/upload/c_thumb,w_200,g_face/v1727267071/Cookies_casos_de_la_vida_real_3_er8kcf.png"
      alt=""
  /></a>

  <h2 class="post-h2">Propiedades de una cookie</h2>
  <app-code-highlight [code]="code_array[1]" language="ruby" />

  <h3 class="post-h3">my_cookie:</h3>
  <p class="post-p">
    El nombre de tu cookie. Ponle el nombre de la chica que te gustaba y te rechaz√≥ por ser programador üòÖ. Una buena
    pr√°ctica es poner un nombre intuitivo y que comience con barra baja: <span class="post-span">_misitio_session</span>
  </p>

  <h3 class="post-h3">value:</h3>
  <p class="post-p">
    Es el valor que le quieres dar a tu cookie. No pongas cosas complejas como modelos de active record, es mejor¬†
    mantener el valor lo m√°s simple posible. Por ejemplo si quieres guardar un modelo de active record solo guarda su id
    y luego lo buscas con eso
  </p>

  <h3 class="post-h3">domain:</h3>
  <p class="post-p">
    La propiedad domain nos dice que dominio o subdominio puede acceder (leer) la cookie. Veamos algunos ejemplos:
  </p>

  <p class="post-p">
    Nuestro Dominio sera:
    <p-tag severity="success" value="ruby_latam.com" />
    <br />
    El subdominio que cre√≥ la cookie sera
    <p-tag severity="info" value="noticias.ruby_latam.com" />
  </p>

  <p class="post-p font-semibold font-italic">Sin poner la propiedad domain</p>
  <p class="post-p">Solo enviar√° la cookie al subdominio que la cre√≥ y a ning√∫n otro.</p>
  <p-card [style]="{ margin: '20px' }">
    <ul>
      <li>
        <p class="post-p">
          ‚úÖ
          <p-tag severity="success" value="noticias.ruby_latam.com" />
          SI podr√° leer la cookie
        </p>
      </li>
      <li>
        <p class="post-p">
          ‚ùå
          <p-tag severity="danger" value="empleos.ruby_latam.com" />
          NO podr√° leer la cookie.
        </p>
      </li>
    </ul>
  </p-card>

  <p-divider />
  <p class="post-p font-semibold font-italic">domain: .ruby_latam.com</p>
  <p class="post-p">Enviar√° a todos los subdominios.</p>
  <p-card [style]="{ margin: '20px' }">
    <ul>
      <li>
        <p class="post-p">
          ‚úÖ
          <p-tag severity="success" value="noticias.ruby_latam.com" />
          SI podr√° leer la cookie
        </p>
      </li>
      <li>
        <p class="post-p">
          ‚úÖ
          <p-tag severity="success" value="empleos.ruby_latam.com" />
          SI podr√° leer la cookie.
        </p>
      </li>
    </ul>
  </p-card>

  <p-divider />

  <p class="post-p font-semibold font-italic">domain: :all</p>
  <p class="post-p">Enviar√° a todos los subdominios.</p>
  <p-card [style]="{ margin: '20px' }">
    <ul>
      <li>
        <p class="post-p">
          ‚úÖ
          <p-tag severity="success" value="noticias.ruby_latam.com" />
          SI podr√° leer la cookie
        </p>
      </li>
      <li>
        <p class="post-p">
          ‚úÖ
          <p-tag severity="success" value="empleos.ruby_latam.com" />
          SI podr√° leer la cookie.
        </p>
      </li>
    </ul>
  </p-card>

  <p-divider />

  <p class="post-p font-semibold font-italic">domain: %w(.ruby_latam.com .ruby_europe.org)</p>
  <p class="post-p">Enviar√° a diferentes dominios.</p>
  <p-card [style]="{ margin: '20px' }">
    <ul>
      <li>
        <p class="post-p">
          ‚úÖ
          <p-tag severity="success" value="noticias.ruby_latam.com" />
          SI podr√° leer la cookie
        </p>
      </li>
      <li>
        <p class="post-p">
          ‚úÖ
          <p-tag severity="success" value="empleos.ruby_europe.org" />
          SI podr√° leer la cookie.
        </p>
      </li>
    </ul>
  </p-card>

  <h3 class="post-h3">secure:</h3>
  <p class="post-p">
    Si es true quiere decir que la cookie solo se transmitir√° desde sitios web que tengan
    <span class="post-span">https</span>. Si estas en localhost haciendo pruebas ponla en false.
  </p>
  <p class="post-p">
    Tip: con el siguiente comando se pondra en false si estas en develpment y true si estas en produccion:
  </p>
  <app-code-highlight [code]="code_array[2]" language="ruby" />

  <h3 class="post-h3">http_only:</h3>
  <p class="post-p">
    Si esta opci√≥n est√° como true el Front-end NO podr√° leer la cookie s√≥lo podr√° descifrarla el Back-end.
  </p>

  <h3 class="post-h3">expire_after:</h3>
  <p class="post-p">
    El tiempo en que expira la cookie una vez que no tenga actividad. Si le pones una hora a cada nuevo request se
    actualiza de nuevo para una hora m√°s.
  </p>

  <h3 class="post-h3">same_site:</h3>
  <p class="post-p">
    <span class="font-semibold">none:</span> Permite que la cookie se env√≠e desde cualquier sitio externo. Esto puede
    ocasionar que te hackeen con un ataque Cross Site Request Forgery. Tengo un post en el que te explico como funciona:
  </p>
  <a
    href="https://medium.com/@marceloalarconbarrenechea/entendiendo-como-funciona-el-csfr-en-ruby-on-rails-cf2ed4c45447"
    >Entendiendo como funciona el CSFR en Ruby on Rails</a
  >
  <p class="post-p">
    <span class="font-semibold">lax:</span> Este valor es una buena opci√≥n por defecto, ya que permite que las cookies
    se env√≠en en la mayor√≠a de las solicitudes de navegaci√≥n de nivel superior, pero las bloquea en contextos de
    cross-site en ciertos casos, como formularios POST enviados desde otros sitios. En otras palabras va a aceptar
    request de tipo GET desde otros sitios.
  </p>

  <p class="post-p">
    <span class="font-semibold">strict:</span> En este caso solo se enviar√° la cookie desde el dominio que la cre√≥. Por
    ejemplo la cookie fue creada en <span class="post-span">blog.ruby_latam.com</span> asi que el front-end debe estar
    igual en <span class="post-span">blog.ruby_latam.com</span> porque sino no la mandar√°. Por ejemplo, si tu front-end
    est√° en <span class="post-span">front_end.ruby_latam.com</span> NO se mandar√° la cookie.
  </p>

  <h2 class="post-h2">Volviendote Genio en Cookies de Ruby on Rails ü§Ø</h2>
  <p class="post-p">
    Practiquemos todo lo que ya sabemos: Crea una nueva app de rails y luego genera un controlador en tu terminal as√≠:
  </p>

  <app-code-highlight [code]="code_array[3]" language="shell" />

  <p class="post-p">Abre tu nuevo controlador y en la accion set_cookies crearemos nuestra nueva cookie:</p>
  <app-code-highlight [code]="code_array[4]" language="ruby" />
  <a
    href="https://res.cloudinary.com/dsqwyfxat/image/upload/v1727698911/Cookies_casos_de_la_vida_real_4_zug0o2.png"
    data-lightbox="roadtrip"
    class="cursor justify-items-center"
    ><img
      src="https://res.cloudinary.com/dsqwyfxat/image/upload/c_thumb,w_200,g_face/v1727698911/Cookies_casos_de_la_vida_real_4_zug0o2.png"
      alt=""
  /></a>

  <p class="post-p">
    Como ves la cookie se encuentra all√≠ y est√° lista para leerse. Ahora vamos a nuestra pr√≥xima acci√≥n y pongamos lo
    siguiente:
  </p>
  <app-code-highlight [code]="code_array[5]" language="ruby" />

  <p class="post-p">
    Abrimos la vista correspondiente en <span class="post-span">app/ views/ handle_cookies/ set_cookie.html.erb</span> y
    ponemos lo siguiente:
  </p>
  <app-code-highlight [code]="code_array[6]" language="ruby" />

  <p class="post-p">Y el resultado ya lo podemos ver si vamos a la siguiente url:</p>
  <a
    href="https://res.cloudinary.com/dsqwyfxat/image/upload/v1727699202/Cookies_casos_de_la_vida_real_5_io41tm.png"
    data-lightbox="roadtrip"
    class="cursor justify-items-center"
    ><img
      src="https://res.cloudinary.com/dsqwyfxat/image/upload/c_thumb,w_200,g_face/v1727699202/Cookies_casos_de_la_vida_real_5_io41tm.png"
      alt=""
  /></a>

  <p class="post-p">
    Ten en cuenta que le pusimos el tiempo de expiraci√≥n en 5 minutos, si te tardas mucho en hacer todo el procedimiento
    puede ser que la cookie desaparezca. Para volverla a generar solo visita la primera acci√≥n nuevamente. Listo
    üéâüéâüéâüéâ
  </p>

  <h2 class="post-h2">Dejando atras el n√≠vel junior üèãÔ∏èü•á</h2>
  <p class="post-p">Ahora veremos unos casos m√°s avanzados.</p>

  <h3 class="post-h3">Cookie Signed</h3>
  <p class="post-p">
    Suponte que quieres mandar una cookie al frontend para que lea la informaci√≥n pero no quieres que alguien malicioso
    pueda modificarla. Para eso existe cookies.signed. Lo que har√° ser√° mandar la informaci√≥n al frontend pero firmada
    con una clave que solo tiene el backend, si en alg√∫n momento la informaci√≥n es alterada la cookie dejar√° de ser
    valida y devolver√° nil.
  </p>

  <p class="post-p">Creando:</p>
  <app-code-highlight [code]="code_array[7]" language="ruby" />

  <p class="post-p">Recuperando</p>
  <app-code-highlight [code]="code_array[8]" language="ruby" />

  <h3 class="post-h3">Cookie Encrypted</h3>
  <p class="post-p">
    Esta cookie igual que la anterior ira firmada pero con la diferencia que los datos estaran encriptados y el frontend
    no podra leerla.
  </p>
  <app-code-highlight [code]="code_array[9]" language="ruby" />

  <h3 class="post-h3">Cookie Permanent</h3>
  <p class="post-p">
    Esta cookie tendra una validez de 20 a√±os. Usala si quieres que los datos esten accesibles por un largo periodo de
    tiempo
  </p>
  <app-code-highlight [code]="code_array[10]" language="ruby" />

  <p class="post-p">Tip: Todos estos m√©todos pueden encadenarse:</p>
  <app-code-highlight [code]="code_array[11]" language="ruby" />

  <p class="post-p">
    Espero que hayas conseguido entender como funcionan las cookies. No te olvides que solo este es el comienzo y debes
    profundizar en otros aspectos luego por tu cuenta.
  </p>
  <p class="bg-red-400 text-white p-2 border-round">
    Ruby on Rails es un framework maravilloso que impulsa la creacion rapida y que su comunidad cree firmemente que hay
    formas de avanzar en la tecnologia sin tener que destruirnos entre todos nosotros. Un saludo y hasta la proxima.
  </p>
</article>
